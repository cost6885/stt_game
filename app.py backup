import os
import json
import random
from flask import Flask, render_template, request, jsonify, session
from dotenv import load_dotenv
import openai
from difflib import SequenceMatcher
from datetime import datetime
import base64
import uuid
import time  # time.time() 사용
import re

# 추가: requests 라이브러리
import requests

import redis




load_dotenv()

app = Flask(__name__)

# # Flask 세션 쿠키 설정
# app.config['SESSION_COOKIE_SAMESITE'] = 'None'
app.config['SESSION_COOKIE_SECURE'] = False  # HTTPS 환경에서만 작동할거면 true, 개발환경에서는 false

app.secret_key = "ANY_RANDOM_SECRET_KEY_FOR_SESSION"  # 세션을 사용하려면 반드시 secret_key 설정 (임의 문자열)

# Redis 클라이언트 설정
redis_client = redis.StrictRedis(host='localhost', port=6379, db=0, decode_responses=True)

TOTAL_ROUNDS = 1

SYNONYM_MAP = {
    # 딥러닝 관련
    "딥러닝": ["deep learning", "딥러닝", "딮러닝"],
    "뉴럴": ["neural", "뉴럴"],
    "머신": ["machine", "머신"],
    "번역": ["translation", "번역"],
    "하이퍼파라미터": ["hyperparameter", "하이퍼 파라미터", "하이퍼파라미터"],
    "튜닝": ["tuning", "튜닝"],
    "최적화": ["optimization", "최적화", "오티마이제이션"],
    # 컴퓨팅 관련
    "양자": ["quantum", "양자"],
    "컴퓨팅": ["computing", "컴퓨팅"],
    "큐비트": ["qubit", "큐비트"],
    "클러스터": ["cluster", "클러스터"],
    "병렬처리": ["parallel processing", "병렬처리"],
    "GPU": ["gpu", "GPU", "지피유"],
    # 데이터 분석 및 알고리즘
    "데이터": ["data", "데이터"],
    "알고리즘": ["algorithm", "알고리즘"],
    "분석": ["analysis", "분석"],
    "기법": ["technique", "기법"],
    "파이프라인": ["pipeline", "파이프라인"],
    # 네트워크 및 IoT
    "네트워크": ["network", "네트워크"],
    "IoT": ["iot", "사물인터넷", "아이오티"],
    "디바이스": ["device", "디바이스"],
    # 인공지능
    "인공지능": ["artificial intelligence", "ai", "인공지능", "에이아이"],
    "추천 시스템": ["recommendation system", "추천 시스템"],
    "컴퓨터 비전": ["computer vision", "컴퓨터 비전"],
    # 클라우드 및 서버
    "클라우드": ["cloud", "클라우드"],
    "컨테이너": ["container", "컨테이너"],
    "오케스트레이션": ["orchestration", "오케스트레이션"],
    "서버리스": ["serverless", "서버리스"],
    # 기타 IT 용어
    "증강현실": ["augmented reality", "증강현실", "AR"],
    "증강": ["augmentation", "증강"],
    "스마트": ["smart", "스마트"],
    "트랜잭션": ["transaction", "트랜잭션"],
    "서치 엔진": ["search engine", "서치 엔진"],
    # 생각과 철학
    "positive": ["파지티브", "포지티브"],
    "thinking": ["띵킹", "씽킹"],
    "reflective": ["리플렉티브", "리플렉"],
    "system": ["시스템", "system"],
    # 일상 및 문화
    "음식": ["food", "음식"],
